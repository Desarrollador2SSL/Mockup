<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL v4.0 - Clientes y Proveedores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS del menú reutilizable -->
    <link rel="stylesheet" href="../css/ssl-menu.css">
    <link rel="stylesheet" href="../css/ssl-general.css">

    <!-- CSS del menú especifico -->        
    <link rel="stylesheet" href="../css/ssl-eo-listado-cliente-proveedor.css">

</head>
<body>
    <!-- Contenedor del menú -->
    <div id="menu-container"></div>
    
    <!-- Contenido principal -->
    <main class="content">
        <div class="breadcrumb">
            <div class="breadcrumb-item"><a href="../inicio/ssl_menu.html">Inicio</a></div>
            <div class="breadcrumb-item"><a href="#">Empresas y Organizaciones</a></div>
            <div class="breadcrumb-item active">Clientes y Proveedores</div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">
                Gestión de Empresas, Clientes y Proveedores
            </h1>
            <div class="header-actions">            
                <button class="btn btn-success" onclick="ClienteProveedor.openNewEmpresaModal()">
                    <i class="fas fa-plus"></i> Nueva Empresa
                </button>    
            </div>                        
        </div>            

        <!-- Filtros -->
        <div class="filter-section">
            <h3 style="margin-bottom: 15px;"><i class="fas fa-filter"></i> Filtros de Búsqueda</h3>
            <form class="filter-form">
                <div class="form-group">
                    <label for="filter-rut">RUT</label>
                    <input type="text" id="filter-rut" class="form-control" placeholder="Ej: 76.123.456-7">
                </div>
                <div class="form-group">
                    <label for="filter-nombre">Nombre o Razón Social</label>
                    <input type="text" id="filter-nombre" class="form-control" placeholder="Buscar por nombre">
                </div>
                <div class="form-group">
                    <label for="filter-tipo">Tipo</label>
                    <select id="filter-tipo" class="form-control">
                        <option value="">Todos</option>
                        <option value="cliente">Solo Clientes</option>
                        <option value="proveedor">Solo Proveedores</option>
                        <option value="ambos">Cliente y Proveedor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-giro">Giro Comercial</label>
                    <input type="text" id="filter-giro" class="form-control" placeholder="Buscar por giro">
                </div>
            </form>
            <div class="filter-actions">
                <button type="button" class="btn btn-outline" onclick="ClienteProveedor.clearFilters()">
                    <i class="fas fa-times"></i> Limpiar
                </button>
                <button type="button" class="btn btn-primary" onclick="ClienteProveedor.searchEmpresas()">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </div>

        <!-- Resultados -->
        <div class="results-container">
            <div class="results-header">
                <div>
                    <h2 class="results-title">
                        <i class="fas fa-list"></i>
                        Listado de Empresas
                    </h2>
                    <div class="results-count">Mostrando 10 de 156 empresas</div>
                </div>
            </div>

            <table class="empresas-table">
                <thead>
                    <tr>
                        <th width="15%">RUT</th>
                        <th width="30%">Razón Social</th>
                        <th width="20%">Giro Comercial</th>
                        <th width="15%">Tipo</th>
                        <th width="10%">Línea Crédito</th>
                        <th width="10%">Acciones</th>
                    </tr>
                </thead>
                <tbody id="empresas-tbody">
                    <!-- Contenido dinámico -->
                </tbody>
            </table>
        </div>
    </main>

    <!-- Modal Nueva/Editar Empresa -->
    <div id="empresaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-building"></i> <span id="modal-action">Nueva</span> Empresa</h2>
                <span class="close" onclick="ClienteProveedor.closeEmpresaModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <!-- Datos Básicos -->
                <h3>Datos Básicos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="empresa-rut">RUT <span style="color: red;">*</span></label>
                        <input type="text" id="empresa-rut" class="form-control" placeholder="76.123.456-7" required>
                    </div>
                    <div class="form-group">
                        <label for="empresa-razon">Razón Social <span style="color: red;">*</span></label>
                        <input type="text" id="empresa-razon" class="form-control" placeholder="Nombre de la empresa" required>
                    </div>
                    <div class="form-group">
                        <label for="empresa-giro">Giro Comercial <span style="color: red;">*</span></label>
                        <input type="text" id="empresa-giro" class="form-control" placeholder="Actividad principal" required>
                    </div>
                </div>

                <!-- Dirección Principal -->
                <div class="form-section">
                    <h4><i class="fas fa-map-marker-alt"></i> Dirección Principal</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dir-calle">Calle</label>
                            <input type="text" id="dir-calle" class="form-control" placeholder="Av. Las Condes">
                        </div>
                        <div class="form-group">
                            <label for="dir-numero">Número</label>
                            <input type="text" id="dir-numero" class="form-control" placeholder="1234">
                        </div>
                        <div class="form-group">
                            <label for="dir-region">Región</label>
                            <select id="dir-region" class="form-control">
                                <option value="">Seleccione región</option>
                                <option value="rm">Región Metropolitana</option>
                                <option value="valpo">Región de Valparaíso</option>
                                <option value="biobio">Región del Biobío</option>
                                <option value="araucania">Región de la Araucanía</option>
                                <option value="antofagasta">Región de Antofagasta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dir-comuna">Comuna</label>
                            <select id="dir-comuna" class="form-control">
                                <option value="">Seleccione comuna</option>
                                <option value="las-condes">Las Condes</option>
                                <option value="providencia">Providencia</option>
                                <option value="santiago">Santiago</option>
                                <option value="quilicura">Quilicura</option>
                                <option value="maipu">Maipú</option>
                                <option value="vitacura">Vitacura</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Dirección de Facturación -->
                <div class="form-section">
                    <h4><i class="fas fa-file-invoice"></i> Dirección de Facturación</h4>
                    <div class="checkbox-group">
                        <input type="checkbox" id="same-address" onchange="ClienteProveedor.toggleFacturacion()">
                        <label for="same-address">Usar misma dirección principal</label>
                    </div>
                    <div id="facturacion-fields">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fact-rut">RUT Facturación</label>
                                <input type="text" id="fact-rut" class="form-control" placeholder="76.123.456-7">
                            </div>
                            <div class="form-group">
                                <label for="fact-razon">Razón Social Facturación</label>
                                <input type="text" id="fact-razon" class="form-control" placeholder="Razón social para facturación">
                            </div>
                            <div class="form-group">
                                <label for="fact-direccion">Dirección</label>
                                <input type="text" id="fact-direccion" class="form-control" placeholder="Dirección completa">
                            </div>
                            <div class="form-group">
                                <label for="fact-email">Correo Electrónico</label>
                                <input type="email" id="fact-email" class="form-control" placeholder="facturacion@empresa.cl">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contactos -->
                <div class="form-section">
                    <h4><i class="fas fa-users"></i> Contactos Comerciales / Técnicos</h4>
                    <div class="inline-form">
                        <div class="form-group">
                            <label for="contact-nombre">Nombre</label>
                            <input type="text" id="contact-nombre" class="form-control" placeholder="Nombre completo">
                        </div>
                        <div class="form-group">
                            <label for="contact-cargo">Cargo</label>
                            <input type="text" id="contact-cargo" class="form-control" placeholder="Cargo">
                        </div>
                        <div class="form-group">
                            <label for="contact-celular">Celular</label>
                            <input type="text" id="contact-celular" class="form-control" placeholder="+56 9 1234 5678">
                        </div>
                        <div class="form-group">
                            <label for="contact-tipo">Tipo</label>
                            <select id="contact-tipo" class="form-control">
                                <option value="comercial">Comercial</option>
                                <option value="tecnico">Técnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contact-email">Email</label>
                            <input type="email" id="contact-email" class="form-control" placeholder="email@empresa.cl">
                        </div>
                        <button type="button" class="btn btn-success btn-sm" onclick="ClienteProveedor.addContact()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    
                    <table class="contacts-table" id="contacts-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Cargo</th>
                                <th>Celular</th>
                                <th>Tipo</th>
                                <th>Email</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; color: #666;">No hay contactos agregados</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Tipo de Empresa -->
                <div class="form-section">
                    <h4><i class="fas fa-building"></i> Tipo de Empresa</h4>
                    <div class="checkbox-group">
                        <input type="checkbox" id="es-cliente" onchange="ClienteProveedor.toggleCliente()">
                        <label for="es-cliente">Es Cliente</label>
                    </div>
                    <div id="cliente-fields" style="display: none;">
                        <div class="credit-input">
                            <label>Línea de Crédito de Venta:</label>
                            <input type="text" class="form-control" id="credito-venta" placeholder="$0">
                        </div>
                    </div>
                    
                    <div class="checkbox-group" style="margin-top: 15px;">
                        <input type="checkbox" id="es-proveedor" onchange="ClienteProveedor.toggleProveedor()">
                        <label for="es-proveedor">Es Proveedor</label>
                    </div>
                    <div id="proveedor-fields" style="display: none;">
                        <div class="credit-input">
                            <label>Línea de Crédito de Compra:</label>
                            <input type="text" class="form-control" id="credito-compra" placeholder="$0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="ClienteProveedor.closeEmpresaModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-success" onclick="ClienteProveedor.saveEmpresa()">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Ver Empresa -->
    <div id="viewEmpresaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="view-modal-title"><i class="fas fa-building"></i> <span></span></h2>
                <span class="close" onclick="ClienteProveedor.closeViewEmpresaModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <!-- Información General -->
                <div class="form-section">
                    <h4><i class="fas fa-info-circle"></i> Información General</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>RUT:</label>
                            <p id="view-rut"><strong></strong></p>
                        </div>
                        <div class="form-group">
                            <label>Razón Social:</label>
                            <p id="view-razon"><strong></strong></p>
                        </div>
                        <div class="form-group">
                            <label>Giro Comercial:</label>
                            <p id="view-giro"></p>
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <p id="view-tipo"></p>
                        </div>
                    </div>
                </div>

                <!-- Tabs para Cliente/Proveedor -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-button active" onclick="ClienteProveedor.switchTab('info-general')">
                            <i class="fas fa-info"></i> Información
                        </button>
                        <button class="tab-button" onclick="ClienteProveedor.switchTab('subcarpeta-cliente')">
                            <i class="fas fa-user-tie"></i> Cliente
                        </button>
                        <button class="tab-button" onclick="ClienteProveedor.switchTab('subcarpeta-proveedor')">
                            <i class="fas fa-truck"></i> Proveedor
                        </button>
                    </div>

                    <!-- Tab Información General -->
                    <div id="info-general" class="tab-content active">
                        <h4>Direcciones</h4>
                        <div class="form-grid">
                            <div>
                                <h5>Dirección Principal</h5>
                                <p id="view-direccion-principal"></p>
                            </div>
                            <div>
                                <h5>Dirección de Facturación</h5>
                                <p id="view-direccion-facturacion"></p>
                                <p id="view-email-facturacion"></p>
                            </div>
                        </div>

                        <h4 style="margin-top: 20px;">Contactos</h4>
                        <table class="contacts-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Cargo</th>
                                    <th>Celular</th>
                                    <th>Tipo</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody id="view-contacts-tbody">
                                <!-- Contenido dinámico -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Tab Subcarpeta Cliente -->
                    <div id="subcarpeta-cliente" class="tab-content">
                        <div class="credit-summary">
                            <div class="summary-item">
                                <div class="summary-value amount-positive" id="cliente-credito-total">$0</div>
                                <div class="summary-label">Línea de Crédito Total</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value amount-negative" id="cliente-credito-usado">$0</div>
                                <div class="summary-label">Monto Ocupado</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="cliente-credito-disponible">$0</div>
                                <div class="summary-label">Disponible</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="cliente-porcentaje">0%</div>
                                <div class="summary-label">% Utilización</div>
                            </div>
                        </div>

                        <div class="filter-controls">
                            <label>Filtrar por:</label>
                            <select id="cliente-filter-mes">
                                <option value="">Mes</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5" selected>Mayo</option>
                            </select>
                            <select id="cliente-filter-year">
                                <option value="2025" selected>2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>

                        <h4>Obras Asociadas como Cliente</h4>
                        <table class="obras-table">
                            <thead>
                                <tr>
                                    <th>Obra</th>
                                    <th>Cantidad OC</th>
                                    <th>Monto Vendido</th>
                                    <th>Monto por Cobrar</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="obras-cliente-tbody">
                                <!-- Contenido dinámico -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Tab Subcarpeta Proveedor -->
                    <div id="subcarpeta-proveedor" class="tab-content">
                        <div class="credit-summary">
                            <div class="summary-item">
                                <div class="summary-value amount-positive" id="proveedor-credito-total">$0</div>
                                <div class="summary-label">Línea de Crédito Total</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value amount-negative" id="proveedor-credito-usado">$0</div>
                                <div class="summary-label">Monto Ocupado</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="proveedor-credito-disponible">$0</div>
                                <div class="summary-label">Disponible</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="proveedor-porcentaje">0%</div>
                                <div class="summary-label">% Utilización</div>
                            </div>
                        </div>

                        <div class="filter-controls">
                            <label>Filtrar por:</label>
                            <select id="proveedor-filter-mes">
                                <option value="">Mes</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5" selected>Mayo</option>
                            </select>
                            <select id="proveedor-filter-year">
                                <option value="2025" selected>2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>

                        <h4>Obras Asociadas como Proveedor</h4>
                        <table class="obras-table">
                            <thead>
                                <tr>
                                    <th>Obra / Cliente</th>
                                    <th>Cantidad OC Recibidas</th>
                                    <th>Monto Facturado</th>
                                    <th>Monto por Pagar</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="obras-proveedor-tbody">
                                <!-- Contenido dinámico -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="ClienteProveedor.closeViewEmpresaModal()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
                <button class="btn btn-warning" onclick="ClienteProveedor.editFromView()">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn btn-primary" onclick="ClienteProveedor.printEmpresa()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/menu-component.js"></script>
    <script src="../js/ssl-eo-listado-cliente-proveedor.js"></script>

    <script>
        // Inicializar el menú con la sección activa
        SSLMenu.load('empresas-organizaciones', 'clientes-proveedores');
    </script>
</body>
</html>